---
description: 既存サイトからコンテンツを移行する
argument-hint: [移行元サイトのURL（省略可）]
---

# サイト移行

使用するスキル: cmx-content

既存サイトのコンテンツをスクレイピングし、CMX に投入します。

## 参照ドキュメント

- @cmx/site-config.md
- @workflows/style-guide.md

## 事前確認

1. `.env.local` に `CMX_API_KEY`, `CMX_API_URL` が設定済みか
2. Admin 側でコレクションが登録済みか
3. 移行元サイトがアクセス可能か

## 手順

### 1. 移行元の情報収集

入力: $ARGUMENTS

- 引数あり → そのURLを移行元として使用
- 引数なし → 移行元サイトのURLを質問

以下を確認:
- sitemap.xml があるか → あれば URL 一覧を自動取得
- なければ移行対象の URL リストをユーザーに確認

### 2. ページ構造の分析

移行元のページを数件サンプリングし、構造を把握:

- ブログ記事、ニュース、固定ページなどの分類
- 共通のヘッダー/フッター/サイドバー（除外対象）
- コンテンツ本文の DOM セレクタ

### 3. コレクションへの振り分け

移行元のページ分類と CMX のコレクションをマッピング:

```
移行元: /blog/*      → CMX: {blogコレクション名}
移行元: /news/*      → CMX: {newsコレクション名}
移行元: /about, /services → CMX: {pageコレクション名}
```

ユーザーにマッピングを確認してもらう。

### 4. スクレイピング & 変換

各ページを取得し HTML → MDX に変換:

- タイトル、本文、メタ説明文を抽出
- HTML タグを Markdown 構文に変換
- 不要な要素（ナビ、広告、フッター等）を除去
- 画像は外部 URL のまま維持

### 5. 投入前の確認

変換結果のサンプルをユーザーに提示:

```
変換サンプル（最初の記事）:

タイトル: {タイトル}
Slug: {slug}
コレクション: {コレクション名}
---
{MDXの冒頭100行}
---

{残りN件}も同様に変換済みです。投入してよろしいですか？
```

### 6. SDK API で一括投入

全記事を `draft` ステータスで投入。

### 7. 確認 & 調整

- Admin の投稿一覧で全記事を確認
- プレビューで変換品質をチェック
- 問題のある記事は修正
- 確認後、一括 publish の要否をユーザーに確認

## 出力

```
移行が完了しました:

- 取得: {n}ページ
- 投入: {n}件（draft）
  - {コレクション名}: {n}件
  - {コレクション名}: {n}件
- スキップ: {n}件（理由: {理由}）

Admin の投稿一覧で内容を確認し、問題なければ公開してください。
```
